üéØ PROMPT DE CONTEXTO PARA CLAUDE CODE - M√ìDULO ORGANIZATION
CONTEXTO DEL DESARROLLO ACTUAL
Est√°s desarrollando el M√≥dulo Organization de ZentraQMS, comenzando con el Wizard de Configuraci√≥n Inicial - Paso 1: Datos B√°sicos de la Instituci√≥n. Este m√≥dulo ser√° el n√∫cleo que gestiona toda la informaci√≥n organizacional del sistema, no solo la configuraci√≥n inicial, sino tambi√©n la gesti√≥n continua de la estrategia, estructura y gobernanza de la organizaci√≥n.
ARQUITECTURA DEL M√ìDULO ORGANIZATION
El m√≥dulo organization es uno de los m√≥dulos core del sistema y contendr√°:

Informaci√≥n b√°sica: Datos legales, sedes, contacto
Planeaci√≥n estrat√©gica: Misi√≥n, visi√≥n, valores, objetivos
Estructura organizacional: Organigrama, cargos, responsables
Normograma: Marco regulatorio aplicable
Configuraci√≥n: Preferencias y parametrizaci√≥n

PROYECTO BASE EXISTENTE
Stack Tecnol√≥gico Configurado
Backend:
- Django 5.0 + Django REST Framework
- PostgreSQL
- Docker configurado
- Estructura: /backend/

Frontend:
- React 19 + TypeScript + Vite
- Bootstrap 5.3
- Estructura: /frontend/src/
Sistema de Autenticaci√≥n Implementado
python# Ya existe:
- JWT Authentication funcionando
- Sistema RBAC con 7 roles
- 42 permisos granulares
- Modelos: User, Role, Permission, UserPermission
- Middleware de autenticaci√≥n


OBJETIVO DE ESTE DESARROLLO
Implementar el M√≥dulo Organization comenzando con el wizard de configuraci√≥n inicial. Este wizard captura los datos fundamentales en 3 pasos, siendo el Paso 1 el foco actual:

Informaci√≥n Legal y Clasificaci√≥n: Raz√≥n social, NIT, tipo y sector
Sede Principal y Adicionales: Gesti√≥n de ubicaciones
Identidad Organizacional: Misi√≥n, visi√≥n, valores (Paso 2 - futuro)
Vigencias y Per√≠odos: Configuraci√≥n temporal (Paso 3 - futuro)



üìã TAREAS DE DESARROLLO - M√ìDULO ORGANIZATION: PASO 1
üóÑÔ∏è BACKEND TASKS
1. MODELOS DE DATOS
pythonTASK-001: Crear modelo Organization
- [ ] Campos: razon_social, nombre_comercial, nit, digito_verificacion
- [ ] Campos: tipo_organizacion (choices), sector_economico (choices)
- [ ] Campos: tama√±o_empresa (choices), logo, fecha_fundacion
- [ ] Campos: created_at, updated_at, created_by, updated_by
- [ ] Validaci√≥n de NIT √∫nico
- [ ] M√©todo para calcular d√≠gito de verificaci√≥n
pythonTASK-002: Crear modelo Headquarters (Sedes)
- [ ] Campos: organization (FK), nombre, tipo (principal/sucursal)
- [ ] Campos: direccion, ciudad, departamento, pais
- [ ] Campos: telefono, email, sitio_web
- [ ] Campos: coordenadas_gps (opcional), codigo_postal
- [ ] Campos: is_main (boolean), is_active
- [ ] Constraint: Solo una sede principal por organizaci√≥n
pythonTASK-003: Crear modelo SectorTemplate
- [ ] Campos: sector, nombre_template, descripcion
- [ ] Campos: data_json (configuraci√≥n predefinida)
- [ ] Campos: is_active, version
- [ ] M√©todo para aplicar template a organizaci√≥n
2. APIS REST
pythonTASK-004: API Organization CRUD
- [ ] GET /api/organization/info/ (obtener datos actuales)
- [ ] POST /api/organization/info/ (crear inicial)
- [ ] PUT /api/organization/info/{id}/ (actualizar)
- [ ] PATCH /api/organization/info/{id}/ (actualizaci√≥n parcial)
pythonTASK-005: API Headquarters CRUD
- [ ] GET /api/organization/headquarters/ (listar todas las sedes)
- [ ] POST /api/organization/headquarters/ (crear sede)
- [ ] PUT /api/organization/headquarters/{id}/ (actualizar sede)
- [ ] DELETE /api/organization/headquarters/{id}/ (eliminar sede)
- [ ] POST /api/organization/headquarters/{id}/set-main/ (establecer como principal)
pythonTASK-006: API de Validaciones
- [ ] POST /api/organization/validate/nit/ (validar NIT y d√≠gito)
- [ ] GET /api/organization/validate/organization-exists/ (verificar si ya existe config)
- [ ] POST /api/organization/validate/email/ (validar formato email)
pythonTASK-007: API de Templates
- [ ] GET /api/organization/templates/sectors/ (listar plantillas por sector)
- [ ] GET /api/organization/templates/{id}/ (obtener detalle plantilla)
- [ ] POST /api/organization/templates/apply/ (aplicar plantilla a organizaci√≥n)
- [ ] GET /api/organization/templates/preview/ (preview antes de aplicar)
3. L√ìGICA DE NEGOCIO
pythonTASK-008: Servicio de Validaci√≥n NIT
- [ ] Algoritmo de c√°lculo d√≠gito verificaci√≥n para Colombia
- [ ] Validaci√≥n de formato (###.###.###-#)
- [ ] Endpoint para guardado parcial (draft)
- [ ] Modelo DraftConfiguration para borradores
- [ ] Limpieza autom√°tica de drafts antiguos (>30 d√≠as)
- [ ] Merge de draft con datos finales
pythonTASK-010: Sistema de Auditor√≠a
- [ ] Registro de todos los cambios en Organization
- [ ] Log de qui√©n, cu√°ndo y qu√© cambi√≥
- [ ] Capacidad de rollback
- [ ] API para consultar historial
üé® FRONTEND TASKS
4. COMPONENTES DE UI
tsxTASK-011: Componente WizardContainer
- [ ] Layout del wizard con stepper (3 pasos)
- [ ] Navegaci√≥n entre pasos
- [ ] Validaci√≥n antes de avanzar
- [ ] Indicador de progreso visual
- [ ] Manejo de estado global del wizard
tsxTASK-012: Componente OrganizationBasicForm
- [ ] Formulario con todos los campos b√°sicos
- [ ] Integraci√≥n con React Hook Form
- [ ] Validaciones con Yup/Zod
- [ ] Manejo de campos requeridos/opcionales
tsxTASK-013: Componente NitInput
- [ ] Input compuesto (NIT + d√≠gito)
- [ ] Formateo autom√°tico (###.###.###)
- [ ] Validaci√≥n en tiempo real
- [ ] C√°lculo autom√°tico del d√≠gito
- [ ] Feedback visual (‚úì/‚úó)
tsxTASK-014: Componente SelectWithOther
- [ ] Select con opci√≥n "Otro"
- [ ] Campo de texto condicional
- [ ] Validaci√≥n din√°mica
- [ ] Para sector econ√≥mico y otros campos
tsxTASK-015: Componente HeadquartersManager
- [ ] Lista de sedes actuales
- [ ] Modal para agregar/editar sede
- [ ] Marcar sede principal
- [ ] Validaci√≥n de al menos una sede
- [ ] Drag & drop para reordenar
tsxTASK-016: Componente TemplateSelector
- [ ] Dropdown de plantillas disponibles
- [ ] Preview de plantilla en modal
- [ ] Confirmaci√≥n antes de aplicar
- [ ] Indicador de campos que se sobrescribir√°n
5. SERVICIOS Y HOOKS
typescriptTASK-017: Hook useOrganization
- [ ] Cargar datos de organizaci√≥n
- [ ] Guardar/actualizar organizaci√≥n
- [ ] Manejo de estado de carga
- [ ] Manejo de errores
- [ ] Cache local
typescriptTASK-018: Hook useAutoSave
- [ ] Debounce de 30 segundos
- [ ] Indicador visual de guardado
- [ ] Recuperaci√≥n ante fallas
- [ ] Sincronizaci√≥n con backend
- [ ] Detecci√≥n de cambios
typescriptTASK-019: Servicio de Validaciones
- [ ] Validaci√≥n de NIT
- [ ] Validaci√≥n de email
- [ ] Validaci√≥n de tel√©fono
- [ ] Validaciones as√≠ncronas
- [ ] Cache de validaciones
typescriptTASK-020: Hook useWizardNavigation
- [ ] Control de navegaci√≥n entre pasos
- [ ] Validaci√≥n antes de avanzar
- [ ] Guardado al cambiar de paso
- [ ] Prevenci√≥n de p√©rdida de datos
- [ ] Shortcuts de teclado
6. INTEGRACIONES Y UTILIDADES
typescriptTASK-021: Integraci√≥n con API de Geolocalizaci√≥n
- [ ] Autocompletar ciudad/departamento
- [ ] Validaci√≥n de direcciones
- [ ] Sugerencias mientras escribe
- [ ] Coordenadas GPS opcionales
typescriptTASK-022: Sistema de Tooltips
- [ ] Componente Tooltip reutilizable
- [ ] Contenido contextual por campo
- [ ] Posicionamiento inteligente
- [ ] Accesible (ARIA)
typescriptTASK-023: Manejo de Errores
- [ ] Interceptor de errores HTTP
- [ ] Mensajes de error amigables
- [ ] Retry autom√°tico en fallos de red
- [ ] Logging para debugging
üß™ TESTING TASKS
7. PRUEBAS UNITARIAS
javascriptTASK-024: Tests Backend - Modelos
- [ ] Test validaci√≥n NIT
- [ ] Test constraint sede principal √∫nica
- [ ] Test aplicaci√≥n de templates
- [ ] Test auditor√≠a de cambios
javascriptTASK-025: Tests Backend - APIs
- [ ] Test CRUD Organization
- [ ] Test CRUD Headquarters
- [ ] Test validaciones
- [ ] Test auto-guardado
javascriptTASK-026: Tests Frontend - Componentes
- [ ] Test formulario principal
- [ ] Test validaci√≥n NIT
- [ ] Test gesti√≥n de sedes
- [ ] Test navegaci√≥n wizard
javascriptTASK-027: Tests Frontend - Hooks
- [ ] Test useOrganization
- [ ] Test useAutoSave
- [ ] Test useWizardNavigation
8. PRUEBAS DE INTEGRACI√ìN
javascriptTASK-028: Tests E2E - Flujo Completo
- [ ] Test crear organizaci√≥n desde cero
- [ ] Test aplicar plantilla
- [ ] Test agregar m√∫ltiples sedes
- [ ] Test auto-guardado y recuperaci√≥n
üéØ DEFINICI√ìN DE "DONE"
Para cada tarea:

 C√≥digo implementado y funcionando
 Tests unitarios pasando (>80% cobertura)
 Documentaci√≥n de c√≥digo (JSDoc/docstrings)
 Code review aprobado
 Sin errores de linting/formatting
 Responsive (mobile/tablet/desktop)
 Accesible (WCAG 2.1 AA)
 Internacionalizaci√≥n preparada

üìä ESTIMACI√ìN Y PRIORIDAD
Prioridad Alta (Semana 1)

TASK-001 a TASK-010 (Backend base)
TASK-011, TASK-012 (UI base)

Prioridad Media (Semana 1-2)

TASK-013 a TASK-016 (Componentes espec√≠ficos)
TASK-017 a TASK-020 (Hooks y servicios)

Prioridad Baja (Semana 2)

TASK-021 a TASK-023 (Integraciones)
TASK-024 a TASK-028 (Testing)

üîÑ DEPENDENCIAS
mermaidgraph TD
    A[TASK-001: Modelo Organization] --> B[TASK-004: API Organization]
    A --> C[TASK-002: Modelo Headquarters]
    C --> D[TASK-005: API Headquarters]
    
    B --> E[TASK-017: Hook useOrganization]
    D --> F[TASK-015: HeadquartersManager]
    
    G[TASK-011: WizardContainer] --> H[TASK-012: OrganizationBasicForm]
    H --> I[TASK-013: NitInput]
    H --> J[TASK-014: SelectWithOther]
    
    E --> H
    F --> H
    
    K[TASK-018: useAutoSave] --> H
    L[TASK-020: useWizardNavigation] --> G
    
    style A fill:#e1f5fe
    style G fill:#fff3e0
üí° NOTAS T√âCNICAS
Consideraciones Especiales:

NIT Validation: Implementar algoritmo m√≥dulo 11 para Colombia
Auto-save: Usar localStorage como fallback si falla el servidor
Templates: Guardar como JSON para flexibilidad
Headquarters: Implementar soft-delete para mantener historial
Performance: Lazy load del componente de geolocalizaci√≥n
UX: Mostrar spinner sutil durante auto-guardado
Accesibilidad: Todos los campos con labels ARIA apropiados

RUTAS Y ENDPOINTS
Backend URLs
python# organization/urls.py
urlpatterns = [
    # Informaci√≥n b√°sica
    path('api/organization/info/', OrganizationInfoView),
    path('api/organization/info/<int:id>/', OrganizationDetailView),
    
    # Sedes
    path('api/organization/headquarters/', HeadquartersViewSet),
    path('api/organization/headquarters/<int:id>/', HeadquartersDetailView),
    path('api/organization/headquarters/<int:id>/set-main/', SetMainHeadquarters),
    
    # Validaciones
    path('api/organization/validate/nit/', ValidateNIT),
    path('api/organization/validate/organization-exists/', CheckOrganizationExists),
    path('api/organization/validate/email/', ValidateEmail),
    
    # Templates
    path('api/organization/templates/sectors/', SectorTemplatesList),
    path('api/organization/templates/<int:id>/', TemplateDetail),
    path('api/organization/templates/apply/', ApplyTemplate),
    path('api/organization/templates/preview/', PreviewTemplate),
    
    # Auto-guardado
    path('api/organization/draft/', DraftConfiguration),
    path('api/organization/draft/<int:id>/', DraftDetail),
    
    # Wizard
    path('api/organization/setup/status/', SetupStatus),
    path('api/organization/setup/complete/', CompleteSetup),
]
Frontend Routes
typescript// React Router paths
const organizationRoutes = [
  {
    path: '/organization',
    element: <OrganizationLayout />,
    children: [
      { index: true, element: <Navigate to="/organization/dashboard" /> },
      { path: 'dashboard', element: <OrganizationDashboard /> },
      { path: 'setup', element: <SetupWizard /> },
      { path: 'settings', element: <OrganizationSettings /> },
      // Futuras rutas:
      { path: 'strategic', element: <StrategicPlanning /> },
      { path: 'structure', element: <OrganizationalStructure /> },
    ]
  }
];
NAVEGACI√ìN EN EL SISTEMA
typescript// Ubicaci√≥n en el men√∫ principal
const menuItems = [
  {
    title: 'Dashboard',
    icon: 'ri-dashboard-line',
    path: '/dashboard'
  },
  {
    title: 'Organizaci√≥n',  // üè¢ Segundo en el men√∫
    icon: 'ri-building-line',
    path: '/organization',
    submenu: [
      { 
        title: 'Informaci√≥n General', 
        path: '/organization/dashboard',
        permission: 'organization.view_info'
      },
      { 
        title: 'Configuraci√≥n Inicial', 
        path: '/organization/setup',
        permission: 'organization.setup_wizard'
      },
      { 
        title: 'Ajustes', 
        path: '/organization/settings',
        permission: 'organization.edit_info'
      }
    ]
  },
  // ... otros m√≥dulos futuros (Procesos, Auditor√≠as, etc.)
];
PERMISOS RBAC DEL M√ìDULO
python# Nuevos permisos a agregar al sistema
ORGANIZATION_PERMISSIONS = [
    # Permisos b√°sicos
    'organization.view_info',           # Ver informaci√≥n de la organizaci√≥n
    'organization.edit_info',           # Editar informaci√≥n b√°sica
    'organization.delete_info',         # Eliminar informaci√≥n (solo super_admin)
    
    # Gesti√≥n de sedes
    'organization.view_headquarters',   # Ver sedes
    'organization.manage_headquarters', # Crear/editar/eliminar sedes
    
    # Configuraci√≥n estrat√©gica (futuro)
    'organization.manage_strategic',    # Gestionar misi√≥n/visi√≥n/objetivos
    'organization.manage_structure',    # Gestionar estructura organizacional
    
    # Setup inicial
    'organization.setup_wizard',        # Acceso al wizard de configuraci√≥n
    'organization.apply_templates',     # Aplicar plantillas sectoriales
]

# Asignaci√≥n por rol
ROLE_PERMISSIONS = {
    'super_admin': ['organization.*'],  # Todos los permisos
    'admin': ['organization.*'],
    'coordinador': [
        'organization.view_info',
        'organization.edit_info',
        'organization.view_headquarters',
        'organization.manage_headquarters',
        'organization.setup_wizard',
        'organization.apply_templates'
    ],
    'auditor': [
        'organization.view_info',
        'organization.view_headquarters'
    ],
    'consulta': [
        'organization.view_info',
        'organization.view_headquarters'
    ]
}
FLUJO DE NAVEGACI√ìN
mermaidgraph TD
    A[Login] --> B{¬øExiste Organization?}
    B -->|No| C[Redirect: /organization/setup]
    B -->|S√≠| D[Dashboard]
    
    C --> E[Wizard Step 1: Datos B√°sicos]
    E --> F[Wizard Step 2: Identidad]
    F --> G[Wizard Step 3: Vigencias]
    G --> H[Setup Completo]
    H --> I[/organization/dashboard]
    
    D --> J[Men√∫ Organizaci√≥n]
    J --> I
    
    I --> K[Ver/Editar Informaci√≥n]
    I --> L[Gestionar Sedes]
    I --> M[Configuraci√≥n]
COMANDOS PARA INICIAR DESARROLLO
bash# Backend - Crear app organization
cd backend
python manage.py startapp organization

# Crear estructura de carpetas del backend
cd organization
mkdir models serializers views services
touch models/{__init__.py,organization.py,headquarters.py,templates.py}
touch serializers/{__init__.py,organization_serializers.py,headquarters_serializers.py}
touch views/{__init__.py,organization_views.py,headquarters_views.py,validation_views.py}
touch services/{__init__.py,nit_validator.py,auto_save_service.py}

# Frontend - Crear estructura del m√≥dulo
cd frontend/src
mkdir -p modules/organization/{pages,components,hooks,services,types}
mkdir -p modules/organization/components/{wizard,forms,headquarters,templates}

# Crear archivos base del frontend
touch modules/organization/pages/{OrganizationDashboard.tsx,SetupWizard.tsx}
touch modules/organization/components/wizard/{WizardContainer.tsx,WizardStep.tsx}
touch modules/organization/hooks/{useOrganization.ts,useAutoSave.ts}
touch modules/organization/services/organizationService.ts
CONSIDERACIONES IMPORTANTES

M√≥dulo Central: organization es un m√≥dulo core que otros m√≥dulos referenciar√°n
Escalabilidad: Estructura preparada para agregar m√°s funcionalidades organizacionales
Reutilizaci√≥n: Componentes y servicios deben ser reutilizables
Consistencia: Mantener los mismos patrones del sistema existente
Performance: Implementar lazy loading donde sea apropiado
Primera vez vs Edici√≥n: Detectar si ya existe configuraci√≥n
Responsividad: Debe funcionar en mobile/tablet/desktop
Accesibilidad: Labels ARIA, navegaci√≥n por teclado
Offline: LocalStorage como fallback
Internacionalizaci√≥n: Preparar para m√∫ltiples idiomas


INSTRUCCI√ìN PARA CLAUDE CODE:
Desarrolla el M√≥dulo Organization siguiendo esta estructura completa. Implementa las tareas en el orden de prioridad establecido, comenzando con los modelos de Django (TASK-001 a TASK-003), luego los serializers y viewsets (TASK-004 a TASK-007). En el frontend, inicia con el WizardContainer y el formulario b√°sico (TASK-011, TASK-012).
Aseg√∫rate de que:

El c√≥digo sea consistente con los patrones ya establecidos en el proyecto (authentication y authorization)
Todos los endpoints sigan el prefijo /api/organization/
Los componentes React est√©n en /modules/organization/
Se implemente el auto-guardado cada 30 segundos
La validaci√≥n de NIT funcione correctamente para Colombia
El m√≥dulo sea la base s√≥lida para toda la gesti√≥n organizacional del sistema

Comienza ejecutando los comandos de setup y luego implementa las tareas en orden de dependencias.


Errores